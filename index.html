<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>תיקון תמלול GPT</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      background: #f0f2f5;
      padding: 20px;
      text-align: center;
    }
    textarea, button {
      width: 100%;
      max-width: 600px;
      padding: 10px;
      margin: 10px auto;
      box-sizing: border-box;
      font-size: 1em;
    }
    #output {
      max-width: 600px;
      margin: 20px auto;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      min-height: 100px;
      white-space: pre-wrap;
      text-align: right;
    }
    .auth-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .auth-buttons button {
      width: 150px;
    }
    .user-info {
      margin-bottom: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>תיקון תמלול וחלוקה לדוברים</h2>

  <div class="user-info" id="userInfo">בודק מצב התחברות...</div>
  <div class="auth-buttons">
    <button id="signInBtn" onclick="signIn()">🔑 התחבר</button>
    <button id="signOutBtn" onclick="signOut()" style="display:none;">📴 התנתק</button>
  </div>

  <textarea id="transcriptInput" rows="10" placeholder="הדבק כאן את התמלול המקורי מהראיון..."></textarea>
  <button onclick="fixTranscript()">✨ תקן את התמלול</button>

  <div id="output">⬅️ כאן תופיע התוצאה המתוקנת...</div>

  <script>
    async function updateUserInfo() {
      const user = await puter.auth.getUser();
      const userInfo = document.getElementById("userInfo");
      const signInBtn = document.getElementById("signInBtn");
      const signOutBtn = document.getElementById("signOutBtn");

      if (user) {
        userInfo.textContent = "מחובר בתור: " + user.username;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
      } else {
        userInfo.textContent = "לא מחובר";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
      }
    }

    async function signIn() {
      await puter.auth.signIn();
      await updateUserInfo();
    }

    async function signOut() {
      await puter.auth.signOut();
      await updateUserInfo();
    }

    async function fixTranscript() {
      const input = document.getElementById("transcriptInput").value.trim();
      const output = document.getElementById("output");
      output.innerHTML = "⏳ מעבד את הבקשה...";

      if (!input) {
        output.innerHTML = "❗ יש להדביק תמלול תחילה.";
        return;
      }

      const prompt = `תקן את התמלול הבא כך שיהיה נאמן למקור, אך כתוב בצורה תקנית וברורה. \
חלק את הדוברים לפי ההקשר וציין בתחילת כל שורה מי מדבר ("דובר 1:", "דובר 2:" וכד'). \
אל תמציא מידע שלא נאמר. זהו התמלול:

${input}`;

      try {
        const response = await puter.ai.chat(prompt, { model: "claude", stream: true });
        output.innerHTML = "";
        for await (const part of response) {
          output.innerHTML += (part?.text || "").replaceAll("\n", "<br>");
        }
      } catch (error) {
        output.innerHTML = "⚠️ שגיאה: " + error.message;
      }
    }

    // התחברות אוטומטית אם כבר מחובר
    updateUserInfo();
  </script>
</body>
</html>
