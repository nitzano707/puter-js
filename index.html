<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>צ'אט GPT עם Puter</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: center;
            background-color: #f6f8fa;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px #ccc;
        }
        select, textarea, input, button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            box-sizing: border-box;
        }
        button {
            cursor: pointer;
        }
        .buttons {
            display: flex;
            gap: 10px;
        }
        .buttons button {
            flex: 1;
        }
        #response {
            white-space: pre-wrap;
            text-align: right;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            min-height: 50px;
        }
        #userInfo {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>צ'אט GPT עם Puter</h2>
        <div id="userInfo">בודק מצב התחברות...</div>

        <div class="buttons">
            <button onclick="signOut()" style="display:none;">💻 התנתק</button>
            <button onclick="signIn()" style="display:none;">🔑 התחבר</button>
        </div>

        <label for="model">בחר מודל:</label>
        <select id="model">
            <option value="gpt-4o-mini">gpt-4o-mini</option>
            <option value="gpt-4.1">gpt-4.1</option>
            <option value="claude-opus-4">claude-opus-4</option>
            <option value="meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo">llama3-8B</option>
        </select>

        <textarea id="chatInput" rows="6" placeholder="הקלד שאלה..."></textarea>
        <div id="response">⬅️ התשובה תופיע כאן</div>
        <button onclick="sendChat()">שלח</button>
    </div>

    <script>
        async function updateUserInfo() {
            const user = await puter.auth.getUser();
            const userInfo = document.getElementById("userInfo");
            const signInBtn = document.querySelector("button[onclick='signIn()']");
            const signOutBtn = document.querySelector("button[onclick='signOut()']");

            if (user) {
                userInfo.innerHTML = `👤 מחובר בתור: <b>${user.name || user.username || user.email}</b>`;
                signInBtn.style.display = "none";
                signOutBtn.style.display = "inline-block";
            } else {
                userInfo.innerText = "🔒 לא מחובר";
                signInBtn.style.display = "inline-block";
                signOutBtn.style.display = "none";
            }
        }

        async function signIn() {
            await puter.auth.signIn();
            updateUserInfo();
        }

        async function signOut() {
            await puter.auth.signOut();
            updateUserInfo();
        }

        async function sendChat() {
            const input = document.getElementById("chatInput").value.trim();
            const model = document.getElementById("model").value;
            const responseBox = document.getElementById("response");

            if (!input) {
                responseBox.innerText = "אנא הקלד שאלה.";
                return;
            }

            responseBox.innerText = "⏳ ממתין לתשובה...";

            try {
                const result = await puter.ai.chat(input, { model });
                responseBox.innerText = result?.message?.content || "❌ לא התקבלה תשובה.";
            } catch (err) {
                responseBox.innerText = "⚠️ שגיאה: " + err.message;
            }
        }

        // Run on load
        updateUserInfo();
    </script>
</body>
</html>
