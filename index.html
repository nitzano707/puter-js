<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×ª×™×§×•×Ÿ ×ª××œ×•×œ GPT</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      background: #f0f2f5;
      padding: 20px;
      text-align: center;
    }
    textarea, button {
      width: 100%;
      max-width: 600px;
      padding: 10px;
      margin: 10px auto;
      box-sizing: border-box;
      font-size: 1em;
    }
    #output {
      max-width: 600px;
      margin: 20px auto;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      min-height: 100px;
      white-space: pre-wrap;
      text-align: right;
    }
    .auth-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .auth-buttons button {
      width: 150px;
    }
    .user-info {
      margin-bottom: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>×ª×™×§×•×Ÿ ×ª××œ×•×œ ×•×—×œ×•×§×” ×œ×“×•×‘×¨×™×</h2>

  <div class="user-info" id="userInfo">×‘×•×“×§ ××¦×‘ ×”×ª×—×‘×¨×•×ª...</div>
  <div class="auth-buttons">
    <button id="signInBtn" onclick="signIn()">ğŸ”‘ ×”×ª×—×‘×¨</button>
    <button id="signOutBtn" onclick="signOut()" style="display:none;">ğŸ“´ ×”×ª× ×ª×§</button>
  </div>

  <textarea id="transcriptInput" rows="10" placeholder="×”×“×‘×§ ×›××Ÿ ××ª ×”×ª××œ×•×œ ×”××§×•×¨×™ ××”×¨××™×•×Ÿ..."></textarea>
  <button onclick="fixTranscript()">âœ¨ ×ª×§×Ÿ ××ª ×”×ª××œ×•×œ</button>

  <div id="output">â¬…ï¸ ×›××Ÿ ×ª×•×¤×™×¢ ×”×ª×•×¦××” ×”××ª×•×§× ×ª...</div>

  <script>
    async function updateUserInfo() {
      const user = await puter.auth.getUser();
      const userInfo = document.getElementById("userInfo");
      const signInBtn = document.getElementById("signInBtn");
      const signOutBtn = document.getElementById("signOutBtn");

      if (user) {
        userInfo.textContent = "××—×•×‘×¨ ×‘×ª×•×¨: " + user.username;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
      } else {
        userInfo.textContent = "×œ× ××—×•×‘×¨";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
      }
    }

    async function signIn() {
      await puter.auth.signIn();
      await updateUserInfo();
    }

    async function signOut() {
      await puter.auth.signOut();
      await updateUserInfo();
    }

    async function fixTranscript() {
      const input = document.getElementById("transcriptInput").value.trim();
      const output = document.getElementById("output");
      output.innerHTML = "â³ ××¢×‘×“ ××ª ×”×‘×§×©×”...";

      if (!input) {
        output.innerHTML = "â— ×™×© ×œ×”×“×‘×™×§ ×ª××œ×•×œ ×ª×—×™×œ×”.";
        return;
      }

      const prompt = `×ª×§×Ÿ ××ª ×”×ª××œ×•×œ ×”×‘× ×›×š ×©×™×”×™×” × ×××Ÿ ×œ××§×•×¨, ××š ×›×ª×•×‘ ×‘×¦×•×¨×” ×ª×§× ×™×ª ×•×‘×¨×•×¨×”. \
×—×œ×§ ××ª ×”×“×•×‘×¨×™× ×œ×¤×™ ×”×”×§×©×¨ ×•×¦×™×™×Ÿ ×‘×ª×—×™×œ×ª ×›×œ ×©×•×¨×” ××™ ××“×‘×¨ ("×“×•×‘×¨ 1:", "×“×•×‘×¨ 2:" ×•×›×“'). \
××œ ×ª××¦×™× ××™×“×¢ ×©×œ× × ×××¨. ×–×”×• ×”×ª××œ×•×œ:

${input}`;

      try {
        const response = await puter.ai.chat(prompt, { model: "claude", stream: true });
        output.innerHTML = "";
        for await (const part of response) {
          output.innerHTML += (part?.text || "").replaceAll("\n", "<br>");
        }
      } catch (error) {
        output.innerHTML = "âš ï¸ ×©×’×™××”: " + error.message;
      }
    }

    // ×”×ª×—×‘×¨×•×ª ××•×˜×•××˜×™×ª ×× ×›×‘×¨ ××—×•×‘×¨
    updateUserInfo();
  </script>
</body>
</html>
